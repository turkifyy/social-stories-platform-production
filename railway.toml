[build]
builder = "nixpacks"
buildCommand = "npm install && npm run build"

[deploy]
startCommand = "npm start"
healthCheckPath = "/api/admin/health"
restartPolicy = "on-failure"

[service]
name = "social-stories-platform"

[env]
NODE_ENV = "production"
PORT = "5000"
TZ = "Asia/Riyadh"
NIXPACKS_NODE_VERSION = "20"
VITE_FIREBASE_API_KEY = "${{VITE_FIREBASE_API_KEY}}"
VITE_FIREBASE_AUTH_DOMAIN = "${{VITE_FIREBASE_AUTH_DOMAIN}}"
VITE_FIREBASE_PROJECT_ID = "${{VITE_FIREBASE_PROJECT_ID}}"
VITE_FIREBASE_STORAGE_BUCKET = "${{VITE_FIREBASE_STORAGE_BUCKET}}"
VITE_FIREBASE_MESSAGING_SENDER_ID = "${{VITE_FIREBASE_MESSAGING_SENDER_ID}}"
VITE_FIREBASE_APP_ID = "${{VITE_FIREBASE_APP_ID}}"
OPENAI_API_KEY = "${{OPENAI_API_KEY}}"
FIREBASE_SERVICE_ACCOUNT = "${{FIREBASE_SERVICE_ACCOUNT}}"
SESSION_SECRET = "${{SESSION_SECRET}}"
CRON_SECRET_KEY = "${{CRON_SECRET_KEY}}"
R2_ACCESS_KEY_ID = "${{R2_ACCESS_KEY_ID}}"
R2_SECRET_ACCESS_KEY = "${{R2_SECRET_ACCESS_KEY}}"
R2_ACCOUNT_ID = "${{R2_ACCOUNT_ID}}"
R2_BUCKET_NAME = "${{R2_BUCKET_NAME}}"
